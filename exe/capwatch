#!/usr/bin/env ruby
# frozen_string_literal: true

require "bundler/setup"
require "capwatch"
include Capwatch

options = CLI.parse(ARGV)

trap("SIGINT") {
  system("clear")
  exit 130
}

config = Fund::Config.new

if options.telegram
  Telegram.new(options.telegram).start
elsif options.all
  loop do
    system("clear")
    puts List.new(config:config).watch
    sleep options.tick
  end
else
  loop do
    provider = Providers::CoinMarketCap.new(config: config)
    fund = Fund.new(provider: provider, config: config)
    system("clear")
    puts fund.console_table
    puts "\nHey there! This is a Demo Fund. Please set up your fund by editing the \"#{Fund::Config::Local::FILE_NAME}\" in your home directory".green if config.demo?
    sleep options.tick
  end
end
